# ğŸ—ï¸ Arquitectura del Pipeline de ConstrucciÃ³n de Portafolios

## ğŸ“Š Diagrama de Flujo Completo

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                                                                     â”‚
â”‚                              ğŸ¦ PIPELINE DE CONSTRUCCIÃ“N DE PORTAFOLIOS                                             â”‚
â”‚                                   Portfolio Construction via Clustering                                             â”‚
â”‚                                                                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                              â”‚   âš™ï¸ CONFIGURACIÃ“N   â”‚
                                              â”‚                     â”‚
                                              â”‚  config/            â”‚
                                              â”‚  â”œâ”€ settings.yaml   â”‚
                                              â”‚  â””â”€ profiles.yaml   â”‚
                                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                         â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                                    â”‚                                    â”‚
                    â–¼                                    â–¼                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                                                                     â”‚
â”‚  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—  â”‚
â”‚  â•‘                                         ORQUESTADOR PRINCIPAL                                                  â•‘  â”‚
â”‚  â•‘                                      pipeline/run_pipeline.py                                                  â•‘  â”‚
â”‚  â•‘                                                                                                                 â•‘  â”‚
â”‚  â•‘   Comandos CLI:                                                                                                 â•‘  â”‚
â”‚  â•‘   â€¢ python -m pipeline.run_pipeline --all           # Ejecutar todo                                            â•‘  â”‚
â”‚  â•‘   â€¢ python -m pipeline.run_pipeline --stages 1,2,3  # Etapas especÃ­ficas                                       â•‘  â”‚
â”‚  â•‘   â€¢ python -m pipeline.run_pipeline --retrain       # Reentrenamiento (2-5)                                    â•‘  â”‚
â”‚  â•‘   â€¢ python -m pipeline.run_pipeline --status        # Ver estado                                               â•‘  â”‚
â”‚  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚                                                                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                         â”‚
                                                         â–¼
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ                                                                                                                     â”ƒ
â”ƒ                                            ETAPA 1: DATA INGESTION                                                  â”ƒ
â”ƒ                                         pipeline/01_data_ingestion.py                                               â”ƒ
â”ƒ                                                    ~13 seg                                                          â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›
         â”‚                                              â”‚                                              â”‚
         â”‚                                              â”‚                                              â”‚
         â–¼                                              â–¼                                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“¥ ENTRADA         â”‚                    â”‚         ğŸ”„ PROCESO                   â”‚        â”‚  ğŸ“¤ SALIDA              â”‚
â”‚                     â”‚                    â”‚                                     â”‚        â”‚                         â”‚
â”‚  data/              â”‚                    â”‚  1. Conectar SQLite                 â”‚        â”‚  data/                  â”‚
â”‚  â””â”€ trading_data.db â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶  â”‚  2. Cargar 1.6M registros           â”‚ â”€â”€â”€â”€â”€â”€â–¶â”‚  â”œâ”€ prices_train.csv    â”‚
â”‚     (SQLite)        â”‚                    â”‚  3. Imputar adj_close               â”‚        â”‚  â””â”€ prices_test.csv     â”‚
â”‚                     â”‚                    â”‚  4. Filtrar tickers (â‰¥5 aÃ±os)       â”‚        â”‚                         â”‚
â”‚  Tabla: prices_dailyâ”‚                    â”‚  5. Pivotar a matriz                â”‚        â”‚  reports/               â”‚
â”‚  Columnas:          â”‚                    â”‚  6. Split train/test (2023-12-31)   â”‚        â”‚  â””â”€ valid_tickers.csv   â”‚
â”‚  - symbol           â”‚                    â”‚  7. Validar benchmark SPY           â”‚        â”‚                         â”‚
â”‚  - date             â”‚                    â”‚                                     â”‚        â”‚  ğŸ“Š 468 tickers         â”‚
â”‚  - OHLCV            â”‚                    â”‚  MÃ³dulos: src/data_loader.py        â”‚        â”‚  ğŸ“… 3,771 fechas        â”‚
â”‚  - adj_close        â”‚                    â”‚           src/utils.py              â”‚        â”‚                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                         â”‚
                                                         â–¼
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ                                                                                                                     â”ƒ
â”ƒ                                          ETAPA 2: FEATURE ENGINEERING                                               â”ƒ
â”ƒ                                       pipeline/02_feature_engineering.py                                            â”ƒ
â”ƒ                                                    ~7 seg                                                           â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›
         â”‚                                              â”‚                                              â”‚
         â”‚                                              â”‚                                              â”‚
         â–¼                                              â–¼                                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“¥ ENTRADA         â”‚                    â”‚         ğŸ”„ PROCESO                   â”‚        â”‚  ğŸ“¤ SALIDA              â”‚
â”‚                     â”‚                    â”‚                                     â”‚        â”‚                         â”‚
â”‚  data/              â”‚                    â”‚  Calcular 21 mÃ©tricas por activo:   â”‚        â”‚  data/                  â”‚
â”‚  â””â”€ prices_train.csvâ”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶  â”‚                                     â”‚ â”€â”€â”€â”€â”€â”€â–¶â”‚  â””â”€ features_matrix.csv â”‚
â”‚                     â”‚                    â”‚  ğŸ“ˆ Retornos:                       â”‚        â”‚                         â”‚
â”‚  config/            â”‚                    â”‚    - return_total                   â”‚        â”‚  467 activos Ã— 21 cols  â”‚
â”‚  â””â”€ settings.yaml   â”‚                    â”‚    - return_annualized              â”‚        â”‚                         â”‚
â”‚     â€¢ risk_free=5%  â”‚                    â”‚    - return_mean_daily              â”‚        â”‚  EstadÃ­sticas:          â”‚
â”‚     â€¢ trading_days  â”‚                    â”‚                                     â”‚        â”‚  â€¢ Return: 9.80%        â”‚
â”‚       =252          â”‚                    â”‚  ğŸ“‰ Riesgo:                         â”‚        â”‚  â€¢ Vol: 29.88%          â”‚
â”‚     â€¢ benchmark=SPY â”‚                    â”‚    - volatility_annual              â”‚        â”‚  â€¢ Sharpe: 0.278        â”‚
â”‚                     â”‚                    â”‚    - downside_dev_annual            â”‚        â”‚  â€¢ Beta: 0.976          â”‚
â”‚                     â”‚                    â”‚    - max_drawdown                   â”‚        â”‚                         â”‚
â”‚                     â”‚                    â”‚    - var_95, cvar_95                â”‚        â”‚                         â”‚
â”‚                     â”‚                    â”‚                                     â”‚        â”‚                         â”‚
â”‚                     â”‚                    â”‚  ğŸ“Š Ratios:                         â”‚        â”‚                         â”‚
â”‚                     â”‚                    â”‚    - sharpe_ratio                   â”‚        â”‚                         â”‚
â”‚                     â”‚                    â”‚    - sortino_ratio                  â”‚        â”‚                         â”‚
â”‚                     â”‚                    â”‚    - calmar_ratio                   â”‚        â”‚                         â”‚
â”‚                     â”‚                    â”‚                                     â”‚        â”‚                         â”‚
â”‚                     â”‚                    â”‚  ğŸ”— Mercado:                        â”‚        â”‚                         â”‚
â”‚                     â”‚                    â”‚    - beta, alpha                    â”‚        â”‚                         â”‚
â”‚                     â”‚                    â”‚    - r_squared                      â”‚        â”‚                         â”‚
â”‚                     â”‚                    â”‚    - correlation_spy                â”‚        â”‚                         â”‚
â”‚                     â”‚                    â”‚                                     â”‚        â”‚                         â”‚
â”‚                     â”‚                    â”‚  ğŸ“ DistribuciÃ³n:                   â”‚        â”‚                         â”‚
â”‚                     â”‚                    â”‚    - skewness, kurtosis             â”‚        â”‚                         â”‚
â”‚                     â”‚                    â”‚    - positive_return_ratio          â”‚        â”‚                         â”‚
â”‚                     â”‚                    â”‚    - gain_loss_ratio                â”‚        â”‚                         â”‚
â”‚                     â”‚                    â”‚                                     â”‚        â”‚                         â”‚
â”‚                     â”‚                    â”‚  ğŸš€ Momentum:                       â”‚        â”‚                         â”‚
â”‚                     â”‚                    â”‚    - vol_of_vol                     â”‚        â”‚                         â”‚
â”‚                     â”‚                    â”‚    - momentum_6m                    â”‚        â”‚                         â”‚
â”‚                     â”‚                    â”‚                                     â”‚        â”‚                         â”‚
â”‚                     â”‚                    â”‚  MÃ³dulo: src/features.py            â”‚        â”‚                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                         â”‚
                                                         â–¼
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ                                                                                                                     â”ƒ
â”ƒ                                            ETAPA 3: CLUSTERING                                                      â”ƒ
â”ƒ                                           pipeline/03_clustering.py                                                 â”ƒ
â”ƒ                                                    ~2 seg                                                           â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›
         â”‚                                              â”‚                                              â”‚
         â”‚                                              â”‚                                              â”‚
         â–¼                                              â–¼                                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“¥ ENTRADA         â”‚                    â”‚         ğŸ”„ PROCESO                   â”‚        â”‚  ğŸ“¤ SALIDA              â”‚
â”‚                     â”‚                    â”‚                                     â”‚        â”‚                         â”‚
â”‚  data/              â”‚                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚        â”‚  data/segmentacion_     â”‚
â”‚  â””â”€ features_matrix â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶  â”‚  â”‚  PASO 1: DBSCAN (Outliers)  â”‚    â”‚ â”€â”€â”€â”€â”€â”€â–¶â”‚  final/                 â”‚
â”‚     .csv            â”‚                    â”‚  â”‚  â€¢ eps=0.5, min_samples=5   â”‚    â”‚        â”‚  â”œâ”€ activos_            â”‚
â”‚                     â”‚                    â”‚  â”‚  â€¢ Detecta 34 outliers      â”‚    â”‚        â”‚  â”‚  segmentados_        â”‚
â”‚  config/            â”‚                    â”‚  â”‚    (7.3% del total)         â”‚    â”‚        â”‚  â”‚  kmeans.csv          â”‚
â”‚  â””â”€ settings.yaml   â”‚                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚        â”‚  â”‚                      â”‚
â”‚     â€¢ n_clusters=4  â”‚                    â”‚               â”‚                     â”‚        â”‚  â”œâ”€ resumen_            â”‚
â”‚     â€¢ outlier_det.  â”‚                    â”‚               â–¼                     â”‚        â”‚  â”‚  segmentos.csv       â”‚
â”‚       =true         â”‚                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚        â”‚  â”‚                      â”‚
â”‚                     â”‚                    â”‚  â”‚  PASO 2: K-Means (K=4)      â”‚    â”‚        â”‚  â”œâ”€ tickers_por_        â”‚
â”‚  Features usadas:   â”‚                    â”‚  â”‚  â€¢ StandardScaler           â”‚    â”‚        â”‚  â”‚  segmento.csv        â”‚
â”‚  â€¢ return_annual.   â”‚                    â”‚  â”‚  â€¢ Silhouette: 0.322        â”‚    â”‚        â”‚  â”‚                      â”‚
â”‚  â€¢ volatility       â”‚                    â”‚  â”‚  â€¢ 4 clusters + outliers    â”‚    â”‚        â”‚  â””â”€ metadata_           â”‚
â”‚  â€¢ sharpe_ratio     â”‚                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚        â”‚     segmentacion.txt    â”‚
â”‚  â€¢ sortino_ratio    â”‚                    â”‚               â”‚                     â”‚        â”‚                         â”‚
â”‚  â€¢ max_drawdown     â”‚                    â”‚               â–¼                     â”‚        â”‚  DistribuciÃ³n:          â”‚
â”‚  â€¢ var_95, cvar_95  â”‚                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚        â”‚  â€¢ Outliers: 34 (7.3%)  â”‚
â”‚  â€¢ beta             â”‚                    â”‚  â”‚  PASO 3: PCA (2D)           â”‚    â”‚        â”‚  â€¢ Conservador: 151     â”‚
â”‚  â€¢ skewness         â”‚                    â”‚  â”‚  â€¢ PC1: ~40% varianza       â”‚    â”‚        â”‚  â€¢ Alto Rend.: 161      â”‚
â”‚  â€¢ kurtosis         â”‚                    â”‚  â”‚  â€¢ PC2: ~20% varianza       â”‚    â”‚        â”‚  â€¢ Moderado: 116        â”‚
â”‚                     â”‚                    â”‚  â”‚  â€¢ VisualizaciÃ³n            â”‚    â”‚        â”‚  â€¢ Estable: 5           â”‚
â”‚                     â”‚                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚        â”‚                         â”‚
â”‚                     â”‚                    â”‚                                     â”‚        â”‚                         â”‚
â”‚                     â”‚                    â”‚  MÃ³dulo: src/clustering.py          â”‚        â”‚                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                         â”‚
                                                         â–¼
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ                                                                                                                     â”ƒ
â”ƒ                                         ETAPA 4: PORTFOLIO SELECTION                                                â”ƒ
â”ƒ                                       pipeline/04_portfolio_selection.py                                            â”ƒ
â”ƒ                                                    ~1 seg                                                           â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›
         â”‚                                              â”‚                                              â”‚
         â”‚                                              â”‚                                              â”‚
         â–¼                                              â–¼                                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“¥ ENTRADA         â”‚                    â”‚         ğŸ”„ PROCESO                   â”‚        â”‚  ğŸ“¤ SALIDA              â”‚
â”‚                     â”‚                    â”‚                                     â”‚        â”‚                         â”‚
â”‚  data/              â”‚                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚        â”‚  reports/               â”‚
â”‚  â”œâ”€ segmentacion_   â”‚                    â”‚  â”‚  MOMENTUM SCORE             â”‚    â”‚        â”‚  â”œâ”€ portafolio_         â”‚
â”‚  â”‚  final/activos_  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶  â”‚  â”‚                             â”‚    â”‚ â”€â”€â”€â”€â”€â”€â–¶â”‚  â”‚  conservador.csv     â”‚
â”‚  â”‚  segmentados.csv â”‚                    â”‚  â”‚  Score = 0.35Ã—Return        â”‚    â”‚        â”‚  â”œâ”€ portafolio_         â”‚
â”‚  â”‚                  â”‚                    â”‚  â”‚        + 0.30Ã—Momentum_6m   â”‚    â”‚        â”‚  â”‚  moderado.csv        â”‚
â”‚  â”œâ”€ prices_train.csvâ”‚                    â”‚  â”‚        + 0.15Ã—Sharpe        â”‚    â”‚        â”‚  â”œâ”€ portafolio_         â”‚
â”‚  â””â”€ prices_test.csv â”‚                    â”‚  â”‚        + 0.20Ã—Beta          â”‚    â”‚        â”‚  â”‚  agresivo.csv        â”‚
â”‚                     â”‚                    â”‚  â”‚                             â”‚    â”‚        â”‚  â”œâ”€ portafolio_         â”‚
â”‚  config/            â”‚                    â”‚  â”‚  (Min-Max normalization)    â”‚    â”‚        â”‚  â”‚  especulativo.csv    â”‚
â”‚  â”œâ”€ settings.yaml   â”‚                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚        â”‚  â””â”€ portafolio_         â”‚
â”‚  â”‚  â€¢ weights       â”‚                    â”‚               â”‚                     â”‚        â”‚     normal.csv          â”‚
â”‚  â”‚  â€¢ initial_cap   â”‚                    â”‚               â–¼                     â”‚        â”‚                         â”‚
â”‚  â”‚    =$10,000      â”‚                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚        â”‚  Por cada perfil:       â”‚
â”‚  â”‚  â€¢ cost=0.1%     â”‚                    â”‚  â”‚  SELECCIÃ“N POR PERFIL       â”‚    â”‚        â”‚  â”œâ”€ backtest_metricas_  â”‚
â”‚  â”‚                  â”‚                    â”‚  â”‚                             â”‚    â”‚        â”‚  â”‚  {perfil}.csv        â”‚
â”‚  â””â”€ profiles.yaml   â”‚                    â”‚  â”‚  ğŸŸ¢ Conservador: C0,C3      â”‚    â”‚        â”‚  â”œâ”€ backtest_equity_    â”‚
â”‚     â€¢ clusters por  â”‚                    â”‚  â”‚  ğŸ”µ Moderado: C2,C3         â”‚    â”‚        â”‚  â”‚  curves_{perfil}.csv â”‚
â”‚       perfil        â”‚                    â”‚  â”‚  ğŸŸ  Agresivo: C1,C2         â”‚    â”‚        â”‚  â”œâ”€ backtest_retornos_  â”‚
â”‚     â€¢ n_assets=10   â”‚                    â”‚  â”‚  ğŸ”´ Especulativo: C-1,C1    â”‚    â”‚        â”‚  â”‚  mensuales.csv       â”‚
â”‚                     â”‚                    â”‚  â”‚  âšª Normal: C0,C2,C3        â”‚    â”‚        â”‚  â””â”€ backtest_           â”‚
â”‚                     â”‚                    â”‚  â”‚                             â”‚    â”‚        â”‚     composicion.csv     â”‚
â”‚                     â”‚                    â”‚  â”‚  Top 10 por score           â”‚    â”‚        â”‚                         â”‚
â”‚                     â”‚                    â”‚  â”‚  Equal-weight (10% c/u)     â”‚    â”‚        â”‚                         â”‚
â”‚                     â”‚                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚        â”‚                         â”‚
â”‚                     â”‚                    â”‚               â”‚                     â”‚        â”‚                         â”‚
â”‚                     â”‚                    â”‚               â–¼                     â”‚        â”‚                         â”‚
â”‚                     â”‚                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚        â”‚                         â”‚
â”‚                     â”‚                    â”‚  â”‚  BACKTESTING                â”‚    â”‚        â”‚                         â”‚
â”‚                     â”‚                    â”‚  â”‚                             â”‚    â”‚        â”‚                         â”‚
â”‚                     â”‚                    â”‚  â”‚  â€¢ Buy & Hold strategy      â”‚    â”‚        â”‚                         â”‚
â”‚                     â”‚                    â”‚  â”‚  â€¢ PerÃ­odo: 2024-2025       â”‚    â”‚        â”‚                         â”‚
â”‚                     â”‚                    â”‚  â”‚  â€¢ Benchmark: SPY           â”‚    â”‚        â”‚                         â”‚
â”‚                     â”‚                    â”‚  â”‚  â€¢ MÃ©tricas: Return, Alpha  â”‚    â”‚        â”‚                         â”‚
â”‚                     â”‚                    â”‚  â”‚    Sharpe, MaxDD, etc.      â”‚    â”‚        â”‚                         â”‚
â”‚                     â”‚                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚        â”‚                         â”‚
â”‚                     â”‚                    â”‚                                     â”‚        â”‚                         â”‚
â”‚                     â”‚                    â”‚  MÃ³dulos: src/portfolio.py          â”‚        â”‚                         â”‚
â”‚                     â”‚                    â”‚           src/backtesting.py        â”‚        â”‚                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                         â”‚
                                                         â–¼
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ                                                                                                                     â”ƒ
â”ƒ                                          ETAPA 5: GENERATE REPORTS                                                  â”ƒ
â”ƒ                                        pipeline/05_generate_reports.py                                              â”ƒ
â”ƒ                                                   ~0.3 seg                                                          â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›
         â”‚                                              â”‚                                              â”‚
         â”‚                                              â”‚                                              â”‚
         â–¼                                              â–¼                                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“¥ ENTRADA         â”‚                    â”‚         ğŸ”„ PROCESO                   â”‚        â”‚  ğŸ“¤ SALIDA              â”‚
â”‚                     â”‚                    â”‚                                     â”‚        â”‚                         â”‚
â”‚  reports/           â”‚                    â”‚  Consolidar todos los resultados    â”‚        â”‚  outputs/api/           â”‚
â”‚  â”œâ”€ portafolio_*.csvâ”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶  â”‚  en formato consumible por          â”‚ â”€â”€â”€â”€â”€â”€â–¶â”‚  â”œâ”€ portfolios.csv      â”‚
â”‚  â””â”€ backtest_*.csv  â”‚                    â”‚  aplicaciÃ³n web:                    â”‚        â”‚  â”‚  (49 registros)      â”‚
â”‚                     â”‚                    â”‚                                     â”‚        â”‚  â”‚                      â”‚
â”‚  data/              â”‚                    â”‚  1. Unificar portafolios            â”‚        â”‚  â”œâ”€ segments.csv        â”‚
â”‚  â””â”€ segmentacion_   â”‚                    â”‚  2. Consolidar segmentos            â”‚        â”‚  â”‚  (5 segmentos)       â”‚
â”‚     final/          â”‚                    â”‚  3. Resumir mÃ©tricas backtest       â”‚        â”‚  â”‚                      â”‚
â”‚                     â”‚                    â”‚  4. Combinar equity curves          â”‚        â”‚  â”œâ”€ backtest_summary    â”‚
â”‚                     â”‚                    â”‚  5. Generar metadata                 â”‚        â”‚  â”‚  .csv (5 perfiles)   â”‚
â”‚                     â”‚                    â”‚                                     â”‚        â”‚  â”‚                      â”‚
â”‚                     â”‚                    â”‚  MÃ³dulo: src/utils.py               â”‚        â”‚  â”œâ”€ equity_curves.csv   â”‚
â”‚                     â”‚                    â”‚                                     â”‚        â”‚  â”‚  (2,475 registros)   â”‚
â”‚                     â”‚                    â”‚                                     â”‚        â”‚  â”‚                      â”‚
â”‚                     â”‚                    â”‚                                     â”‚        â”‚  â”œâ”€ metadata.csv        â”‚
â”‚                     â”‚                    â”‚                                     â”‚        â”‚  â”œâ”€ metadata.json       â”‚
â”‚                     â”‚                    â”‚                                     â”‚        â”‚  â””â”€ README.md           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                         â”‚
                                                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                                                                     â”‚
â”‚                                            ğŸŒ APLICACIÃ“N WEB                                                        â”‚
â”‚                                                                                                                     â”‚
â”‚    La aplicaciÃ³n web consume los archivos CSV de outputs/api/ para mostrar:                                         â”‚
â”‚                                                                                                                     â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚    â”‚  ğŸ“Š Dashboard   â”‚    â”‚  ğŸ’¼ Portafolios â”‚    â”‚  ğŸ“ˆ Backtest    â”‚    â”‚  ğŸ·ï¸ Segmentos   â”‚                         â”‚
â”‚    â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚                         â”‚
â”‚    â”‚  KPIs globales  â”‚    â”‚  ComposiciÃ³n    â”‚    â”‚  Equity curves  â”‚    â”‚  Clustering     â”‚                         â”‚
â”‚    â”‚  Comparativas   â”‚    â”‚  por perfil     â”‚    â”‚  MÃ©tricas       â”‚    â”‚  DistribuciÃ³n   â”‚                         â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚                                                                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ Estructura de Archivos Generados

```
riskmanagement2025/
â”‚
â”œâ”€â”€ ğŸ“Š data/                                    # Datos procesados
â”‚   â”œâ”€â”€ trading_data.db                         # [INPUT] Base de datos SQLite original
â”‚   â”œâ”€â”€ prices_train.csv                        # [ETAPA 1] Precios 2010-2023 (3,276 dÃ­as Ã— 468 tickers)
â”‚   â”œâ”€â”€ prices_test.csv                         # [ETAPA 1] Precios 2024-2025 (495 dÃ­as Ã— 468 tickers)
â”‚   â”œâ”€â”€ features_matrix.csv                     # [ETAPA 2] 21 mÃ©tricas Ã— 467 activos
â”‚   â”‚
â”‚   â””â”€â”€ segmentacion_final/                     # [ETAPA 3] Resultados de clustering
â”‚       â”œâ”€â”€ activos_segmentados_kmeans.csv      # Cada activo con su cluster asignado
â”‚       â”œâ”€â”€ resumen_segmentos.csv               # EstadÃ­sticas por segmento
â”‚       â”œâ”€â”€ tickers_por_segmento.csv            # Lista de tickers por cluster
â”‚       â””â”€â”€ metadata_segmentacion.txt           # ParÃ¡metros del modelo
â”‚
â”œâ”€â”€ ğŸ“ˆ reports/                                 # [ETAPA 4] Resultados de backtesting
â”‚   â”œâ”€â”€ valid_tickers.csv                       # Lista de 468 tickers vÃ¡lidos
â”‚   â”‚
â”‚   â”œâ”€â”€ portafolio_conservador.csv              # 5 archivos de composiciÃ³n
â”‚   â”œâ”€â”€ portafolio_moderado.csv                 #   (ticker, peso, mÃ©tricas)
â”‚   â”œâ”€â”€ portafolio_agresivo.csv
â”‚   â”œâ”€â”€ portafolio_especulativo.csv
â”‚   â”œâ”€â”€ portafolio_normal.csv
â”‚   â”‚
â”‚   â”œâ”€â”€ backtest_metricas_conservador.csv       # 5 archivos de mÃ©tricas
â”‚   â”œâ”€â”€ backtest_metricas_moderado.csv          #   (return, sharpe, maxdd, etc.)
â”‚   â”œâ”€â”€ backtest_metricas_agresivo.csv
â”‚   â”œâ”€â”€ backtest_metricas_especulativo.csv
â”‚   â”œâ”€â”€ backtest_metricas_normal.csv
â”‚   â”‚
â”‚   â”œâ”€â”€ backtest_equity_curves_conservador.csv  # 5 archivos de equity curves
â”‚   â”œâ”€â”€ backtest_equity_curves_moderado.csv     #   (fecha, equity, benchmark)
â”‚   â”œâ”€â”€ backtest_equity_curves_agresivo.csv
â”‚   â”œâ”€â”€ backtest_equity_curves_especulativo.csv
â”‚   â”œâ”€â”€ backtest_equity_curves_normal.csv
â”‚   â”‚
â”‚   â”œâ”€â”€ backtest_retornos_mensuales_*.csv       # 5 archivos de retornos mensuales
â”‚   â””â”€â”€ backtest_composicion_*.csv              # 5 archivos de composiciÃ³n
â”‚
â”œâ”€â”€ ğŸ“¤ outputs/api/                             # [ETAPA 5] Archivos para Web App
â”‚   â”œâ”€â”€ portfolios.csv                          # Consolidado de todos los portafolios
â”‚   â”œâ”€â”€ segments.csv                            # InformaciÃ³n de segmentos
â”‚   â”œâ”€â”€ backtest_summary.csv                    # MÃ©tricas consolidadas
â”‚   â”œâ”€â”€ equity_curves.csv                       # Series temporales unificadas
â”‚   â”œâ”€â”€ metadata.csv                            # Info del pipeline
â”‚   â”œâ”€â”€ metadata.json                           # Info en formato JSON
â”‚   â””â”€â”€ README.md                               # DocumentaciÃ³n de uso
â”‚
â”œâ”€â”€ âš™ï¸ config/                                  # ConfiguraciÃ³n
â”‚   â”œâ”€â”€ settings.yaml                           # ParÃ¡metros del pipeline
â”‚   â””â”€â”€ profiles.yaml                           # DefiniciÃ³n de perfiles
â”‚
â”œâ”€â”€ ğŸ”§ src/                                     # MÃ³dulos de cÃ³digo
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ data_loader.py                          # Carga y preparaciÃ³n de datos
â”‚   â”œâ”€â”€ features.py                             # CÃ¡lculo de mÃ©tricas financieras
â”‚   â”œâ”€â”€ clustering.py                           # Algoritmos de segmentaciÃ³n
â”‚   â”œâ”€â”€ portfolio.py                            # ConstrucciÃ³n de portafolios
â”‚   â”œâ”€â”€ backtesting.py                          # Motor de backtesting
â”‚   â””â”€â”€ utils.py                                # Funciones utilitarias
â”‚
â””â”€â”€ ğŸ”„ pipeline/                                # Scripts del pipeline
    â”œâ”€â”€ __init__.py
    â”œâ”€â”€ run_pipeline.py                         # Orquestador CLI
    â”œâ”€â”€ 01_data_ingestion.py                    # Etapa 1
    â”œâ”€â”€ 02_feature_engineering.py               # Etapa 2
    â”œâ”€â”€ 03_clustering.py                        # Etapa 3
    â”œâ”€â”€ 04_portfolio_selection.py               # Etapa 4
    â””â”€â”€ 05_generate_reports.py                  # Etapa 5
```

---

## ğŸ”„ Flujo de Datos Simplificado

```
                                    FLUJO DE DATOS DEL PIPELINE
                                    
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   SQLite     â”‚
    â”‚   1.6M rows  â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  ETAPA 1     â”‚â”€â”€â”€â”€â–¶â”‚  ETAPA 2     â”‚â”€â”€â”€â”€â–¶â”‚  ETAPA 3     â”‚
    â”‚  Data Ingest â”‚     â”‚  Features    â”‚     â”‚  Clustering  â”‚
    â”‚              â”‚     â”‚              â”‚     â”‚              â”‚
    â”‚  468 tickers â”‚     â”‚  21 mÃ©tricas â”‚     â”‚  5 segmentos â”‚
    â”‚  3,771 dÃ­as  â”‚     â”‚  467 activos â”‚     â”‚  DBSCAN+KMeansâ”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                                      â”‚
                                                      â–¼
                                               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                               â”‚  ETAPA 4     â”‚
                                               â”‚  Portfolio   â”‚
                                               â”‚              â”‚
                                               â”‚  5 perfiles  â”‚
                                               â”‚  Backtest    â”‚
                                               â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                                      â”‚
                                                      â–¼
                                               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                               â”‚  ETAPA 5     â”‚
                                               â”‚  Reports     â”‚
                                               â”‚              â”‚
                                               â”‚  CSV para    â”‚
                                               â”‚  Web App     â”‚
                                               â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                                      â”‚
                                                      â–¼
                                               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                               â”‚  ğŸŒ WEB APP  â”‚
                                               â”‚              â”‚
                                               â”‚  Dashboard   â”‚
                                               â”‚  Portafolios â”‚
                                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## â±ï¸ Tiempos de EjecuciÃ³n

| Etapa | Nombre | Tiempo | DescripciÃ³n |
|-------|--------|--------|-------------|
| 1 | Data Ingestion | ~13s | Carga 1.6M registros, split train/test |
| 2 | Feature Engineering | ~7s | Calcula 21 mÃ©tricas para 467 activos |
| 3 | Clustering | ~2s | DBSCAN + K-Means, PCA |
| 4 | Portfolio Selection | ~1s | Scoring, selecciÃ³n, backtesting |
| 5 | Generate Reports | ~0.3s | ConsolidaciÃ³n para web app |
| **Total** | **Pipeline completo** | **~23s** | |

---

## ğŸ”„ Ciclo de Reentrenamiento (cada 6 meses)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        CICLO DE REENTRENAMIENTO                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    Mes 0                    Mes 6                    Mes 12
      â”‚                        â”‚                        â”‚
      â–¼                        â–¼                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Pipeline  â”‚            â”‚ Pipeline  â”‚            â”‚ Pipeline  â”‚
â”‚ Inicial   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ Retrain   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ Retrain   â”‚
â”‚ --all     â”‚            â”‚ --retrain â”‚            â”‚ --retrain â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Comando:           â”‚
                    â”‚  python -m pipeline â”‚
                    â”‚  .run_pipeline      â”‚
                    â”‚  --retrain          â”‚
                    â”‚                     â”‚
                    â”‚  Ejecuta:           â”‚
                    â”‚  â€¢ Etapa 2 (Features)â”‚
                    â”‚  â€¢ Etapa 3 (Cluster) â”‚
                    â”‚  â€¢ Etapa 4 (Portfolio)â”‚
                    â”‚  â€¢ Etapa 5 (Reports) â”‚
                    â”‚                     â”‚
                    â”‚  Omite:             â”‚
                    â”‚  â€¢ Etapa 1 (Data)   â”‚
                    â”‚    (usa datos exist.)â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Resultados del Ãšltimo Backtest

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         RESULTADOS BACKTEST 2024-2025                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     PERFIL       â”‚   RETORNO    â”‚    ALPHA     â”‚   SHARPE     â”‚    MAX DD      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸŸ¢ Conservador   â”‚    27.64%    â”‚   -16.20%    â”‚    0.516     â”‚    -17.97%     â”‚
â”‚ ğŸ”µ Moderado      â”‚    13.02%    â”‚   -30.82%    â”‚    0.145     â”‚    -17.31%     â”‚
â”‚ ğŸŸ  Agresivo      â”‚    27.19%    â”‚   -16.64%    â”‚    0.496     â”‚    -21.54%     â”‚
â”‚ ğŸ”´ Especulativo  â”‚    50.16%    â”‚    +6.32%    â”‚    0.842     â”‚    -26.22%     â”‚
â”‚ âšª Normal        â”‚    61.86%    â”‚   +18.02%    â”‚    0.944     â”‚    -24.99%     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“Š SPY (Bench)   â”‚    43.84%    â”‚      ---     â”‚    0.961     â”‚    -19.00%     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

   ğŸ† Mejor perfil: NORMAL (+18% alpha sobre SPY)
```
